<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Quy Cháº¿ â€“ ÄÄƒng kÃ½ ca</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b3c2d">

<style>
:root{
  --bg:linear-gradient(135deg,#0b3c2d,#145a4a,#1e7f6d);
  --card:#ffffff;
  --text:#0f172a;
  --accent:#d32f2f;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  display:flex;
  justify-content:center;
}
.container{
  width:100%;
  max-width:420px;
  padding:20px;
}
.card{
  background:var(--card);
  border-radius:22px;
  padding:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.25);
  animation:fade .6s ease;
}
@keyframes fade{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1}
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.toggle{cursor:pointer;font-size:20px}
input{
  width:100%;
  padding:12px;
  margin:14px 0;
  border-radius:14px;
  border:1px solid #ccc;
  font-size:15px;
}
table{width:100%;}
td{padding:8px 0;}
.day{font-weight:600;}
select{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid #ccc;
}
button{
  margin-top:16px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  font-size:16px;
  font-weight:600;
  background:linear-gradient(135deg,#c62828,#e53935);
  color:white;
}
.note{
  margin-top:10px;
  font-size:13px;
  opacity:.7;
}
.copyright{
  margin-top:16px;
  text-align:center;
  font-size:12px;
  opacity:.7;
}

/* â„ï¸ TUYáº¾T */
.snow{
  position:fixed;
  top:-10px;
  width:8px;
  height:8px;
  background:white;
  border-radius:50%;
  opacity:.9;
  animation: fall linear infinite;
  pointer-events:none;
  z-index:999;
}
@keyframes fall{
  to{ transform:translateY(110vh) }
}
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <div class="header">
      <h2>ğŸ„ ÄÄƒng kÃ½ ca lÃ m</h2>
      <div class="toggle">â„ï¸</div>
    </div>

    <input id="name" placeholder="ğŸ‘¤ Nháº­p tÃªn (Quáº£n lÃ½ nháº­p QuanLy)">
    <table id="schedule"></table>

    <button onclick="submitSchedule()">âœ… XÃ¡c nháº­n Ä‘Äƒng kÃ½</button>
    <div class="note">NgÃ y khÃ´ng lÃ m cÃ³ thá»ƒ Ä‘á»ƒ trá»‘ng.</div>
  </div>

  <div class="copyright">
    Â© 2025 An Quy Cháº¿ â€¢ Developed by ÄÃ o ÄÄƒng TÃ¹ng
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  authDomain: "an-quy.firebaseapp.com",
  databaseURL: "https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "an-quy",
  storageBucket: "an-quy.firebasestorage.app",
  messagingSenderId: "672469940026",
  appId: "1:672469940026:web:a38e5b15bbeb2361b84203"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const days=["T2","T3","T4","T5","T6","T7","CN"];
const shifts=[
 {v:"C1",l:"C1"},
 {v:"C2",l:"C2"},
 {v:"C3",l:"C3"},
 {v:"2C_C1_C2",l:"2C (C1 + C2)"},
 {v:"2C_C2_C3",l:"2C (C2 + C3)"},
 {v:"F1",l:"F1"},
 {v:"F2",l:"F2"}
];

const table=document.getElementById("schedule");
days.forEach(d=>{
 table.innerHTML+=`
 <tr>
  <td class="day">${d}</td>
  <td>
   <select id="${d}">
    <option value="">â€” KhÃ´ng lÃ m â€”</option>
    ${shifts.map(s=>`<option value="${s.v}">${s.l}</option>`).join("")}
   </select>
  </td>
 </tr>`;
});

/* ğŸ”„ RESET 0H THá»¨ 2 */
(function autoReset(){
 const now=new Date();
 if(now.getDay()===1 && now.getHours()===0 && now.getMinutes()<2){
  remove(ref(db,"dangKy"));
 }
})();

window.submitSchedule = async ()=>{
 const name=document.getElementById("name").value.trim();
 if(!name) return alert("ChÆ°a nháº­p tÃªn");

 /* ğŸ‘‘ QUáº¢N LÃ */
 if(name==="QuanLy"){
  const snap=await get(ref(db,"dangKy"));
  if(!snap.exists()) return alert("ChÆ°a cÃ³ dá»¯ liá»‡u");

  const map={};
  snap.forEach(n=>{
    const lich=n.val().lich||{};
    Object.entries(lich).forEach(([d,c])=>{
      map[d]=map[d]||{};
      map[d][c]=map[d][c]||[];
      map[d][c].push(n.key);
    });
  });

  let text="ğŸ“Š Tá»”NG Há»¢P Lá»ŠCH\n\n";
  Object.keys(map).forEach(d=>{
    text+=`ğŸ“… ${d}\n`;
    Object.keys(map[d]).forEach(c=>{
      text+=`  ${c}: ${map[d][c].join(", ")}\n`;
    });
    text+="\n";
  });

  alert(text);
  return;
 }

 const lich={};
 days.forEach(d=>{
  const v=document.getElementById(d).value;
  if(v) lich[d]=v;
 });

 await set(ref(db,"dangKy/"+name),{
  ten:name,
  lich,
  time:Date.now()
 });

 alert("ğŸ‰ Gá»­i lá»‹ch thÃ nh cÃ´ng");
};

/* â„ï¸ TUYáº¾T */
for(let i=0;i<40;i++){
 const s=document.createElement("div");
 s.className="snow";
 s.style.left=Math.random()*100+"vw";
 s.style.animationDuration=5+Math.random()*6+"s";
 s.style.opacity=Math.random();
 document.body.appendChild(s);
}

/* SW */
if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
